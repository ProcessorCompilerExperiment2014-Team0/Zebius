# zsim : Zebius simulator

## 使用方法

```
make
./zsim code [testfile] [options]
```

### 入力
* 機械語のファイルをコマンドライン引数として指定します
  * ファイルもリトルエンディアン

### 出力
* 各種データを標準エラー出力に、WRITE命令の出力を標準出力に出力します
  * エラー出力の内容
    * 実行終了時に、各種レジスタの値を出力
    * 実行終了時に、それぞれの命令が発行された回数を出力
* 警告
  * ロード/ストアの際、アドレスが4の倍数で無い場合に警告を出す
  * ストアの際、アドレスがブロックRAMの領域(0〜1023 byte)内の場合に警告を出す

### その他
* 命令は0番地から順に置かれます
* PCが最後の命令の次の番地に到達すると終了とみなします

## テストケース
* 機械語のファイルの後に、期待されるレジスタの値を記したファイルを指定します
  * 指定されなかった場合や全て一致した場合は終了ステータス0を返す
  * 不一致のレジスタが存在した場合はその旨を出力して終了ステータス1を返す

### フォーマット

```
Rn xxxxxxxx
FRn xxxxxxxx
```

* レジスタの名前と、期待される値(符号なし十六進数)を1行に1つ指定する
* 順番は任意
* 指定しないレジスタがあっても良い

## オプション
* --help
  * オプションの説明を出力して終了する
* -d
  * 命令実行ごとに、現在のPCと実行中の命令を出力
* -r
  * 命令実行ごとに、(-dオプションに加え)全てのレジスタの値を出力
* -m
  * ロード命令時に、アドレスと読み込んだ値を出力
  * ストア命令時に、アドレスと書き込む前後の値を出力
* -w
  * WRITE命令において、テキストで詳細に出力する
    * 指定しなかった場合、バイナリで吐き出される
* -n <insts>
  * 浮動小数点演算において、ネイティブの演算を使用する
    * 指定しなかった場合、(実装されているものについては)ソフトウェア実装が使われる
    * instsに命令の名前を指定すると、その命令についてのみネイティブ演算が使用される
      * `-n FADD FSQRT` など
    * instsを指定しない場合、全ての演算にネイティブ演算が使用される
* -l <n>
  * 最大n命令で実行を終了する
    * nは十進数

## READ/WRITEの仕様
### READ
* 標準入力から1バイト読み込み、指定したレジスタの下位1バイトに読み込む
* レジスタの上位3バイトは0で埋められる

### WRITE
* 指定したレジスタの下位1バイトの内容を標準出力に出力する
  * 形式はオプションの項を参照

## 浮動小数点命令
* 現在FPUが使用可能な命令は以下の通り
  * FADD
  * FDIV
  * FMUL
  * FNEG
  * FSQRT
  * FSUB
  * FTRC
  * FLOAT
